### 5.1 AOP 概念

让我们首先来定义一些核心的 AOP 概念和术语。这些术语不是特定于 Spring 的。不幸的是，AOP 术语并不都是那么直观。而且，当同时存在 Spring 自己的术语时，情况将会变得更加令人迷惑。

- 切面：横切多个类的关注点的模块化。事务管理是企业级 Java 应用中横切关注点的一个很好的例子。在 Spring AOP 中，切面使用普通的类实现（[schema-based approach](https://docs.spring.io/spring/docs/5.1.8.RELEASE/spring-framework-reference/core.html#aop-schema)）或者由`@Aspect`注解修饰的普通类（[@AspectJ style](https://docs.spring.io/spring/docs/5.1.8.RELEASE/spring-framework-reference/core.html#aop-ataspectj)）。
- 连接点：程序执行过程中的一个点，比如一个方法的执行或者一个异常的处理。在 Spring AOP 中，连接点永远表示一个方法的执行。
- 增强：被特地连接点的切面携带。增强的类型包括`around`，`before`和`after`三种，稍后我们会讨论这些类型。许多 AOP 框架，包括 Spring，将增强建模为一个拦截器，并在连接点周围维护一个拦截器链。
- 切入点：匹配连接点的谓词。增强与切入点表达式相关联，并在切入点匹配的任何连接点处运行（例如，执行具有特定名称的方法）。由切入点表达式匹配的连接点的概念是 AOP 的核心，Spring 默认使用 AspectJ 切入点表达式语言。
- 引介：声明附加方法或者代表类型的字段。Spring AOP 允许您向任何增强的对象引入新接口（以及相应的实现）。例如，您可以使用引介使bean实现`IsModified`接口，以简化缓存。（引介在 AspectJ 社区中被称为类型间声明。）
- 目标对象：被一个或者多个切面增强的对象。也被称为“被增强的对象”。因为 Spring AOP 是通过使用运行时代理实现，目标对象永远都是被代理的对象。
- AOP 代理：由 AOP 框架创建用来实现切面契约（增强方法执行等等）的对象。在 Spring 框架中，一个 AOP 代理是一个 JDK 动态代理或者一个 CGLIB 代理。
- 织入：将切面与其它应用类型或者对象连接起来以创建增强的对象。此过程可以在编译期（比如，使用 AspectJ 编译器），加载期，或者运行时完成。Spring AOP，如其它纯 Java AOP 框架一样，在运行时执行织入。

Spring AOP 包含下列增强类型：

- Before advice: 在连接点之前运行但无法阻止执行流程进入连接点（除非该增强自身抛出异常）。
- After returning advice: 在连接点正常执行完成之后运行（比如，方法正常返回并没有抛出异常）。
- After throwing advice: 当方法因为抛出异常而退出时执行。
- After (finally) advice: 无论连接点如何退出（正常退出或者抛出异常）此增强都会执行。
- Around advice: 围绕连接点，例如方法调用，的增强。这是最有力的增强。这种增强可以在方法调用之前和之后执行自定义行为。它还负责选择是继续执行连接点，还是通过返回增强自己的返回值或抛出异常来短路被增强的方法执行。

围绕增强是最通用的增强。由于Spring AOP，类似于 AspectJ，提供了全方位的增强类型，因此我们建议您使用可以实现所需行为的最弱的增强类型。例如，如果您只需要使用方法的返回值更新缓存，那么最好实现返回后的增强而不是围绕的增强，尽管围绕的增强可以完成同样的事情。使用最具体的增强类型可以提供更简单的编程模型，减少错误的可能性。例如，您不需要在用于`around`增强的`JoinPoint`上调用`proceed()`方法，这样一来，就不可能出现调用失败的情况。

所有增强参数都是静态类型的，因此您可以使用适当类型的增强参数（例如，方法执行的返回值的类型）而不是`Object`数组。

由切入点匹配的连接点的概念是 AOP 的关键，它将 AOP 与仅提供拦截的旧技术区分开来。切入点使得增强可以独立于面向对象的层次结构进行目标确定。例如，您可以将一个提供声明性事务管理的增强应用于跨多个对象的一组方法（例如服务层中的所有业务操作）。

