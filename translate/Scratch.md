## RMI 应用概览

RMI 应用通常由两个独立程序组成，服务器和客户端。典型的服务器程序创建一些远程对象，使这些对象的引用可访问，并等待客户端调用这些对象上的方法。典型的客户端程序获取服务器上一个或者多个远程对象的引用，然后调用它们上面的方法。RMI 提供了服务器和客户端之间的通信机制，并来回传递信息。这样的程序某些时候会被称为*分布式对象应用*。

分布式对象应用需要完成下列步骤：

- **定位远程对象：** 应用程序可以使用各种机制来获取对远程对象的引用。例如，应用程序可以使用 RMI 的简单命名工具 RMI 注册表注册其远程对象。或者，应用程序可以作为其他远程调用的一部分传递和返回远程对象引用。
- **与远程对象通信：** 远程对象之间的通信细节由 RMI 处理。对程序员来说，远程通信看起来与普通的 Java 方法调用没有什么不同。
- **加载传递过来的对象的类定义：** 因为 RMI 允许对象来回传递，所以它提供了加载对象的类定义以及传输对象数据的机制。

下图描绘了一个 RMI 分布式应用程序，该应用程序使用 RMI 注册表来获取对远程对象的引用。服务器调用注册表以将名称与远程对象关联（或绑定）。客户端在服务器的注册表中按名称查找远程对象，然后在其上调用方法。该图还显示 RMI 系统使用现有的 Web 服务器在需要时从服务器到客户端以及从客户端到服务器加载对象的类定义。

![the RMI system, using an existing web server, communicates from serve to client and from client to server](https://docs.oracle.com/javase/tutorial/figures/rmi/rmi-2.gif)

**动态代码加载的优点**

RMI 的核心和独特功能之一是，如果未在接收者的 Java 虚拟机中定义类，则可以下载对象类的定义。以前仅在单个 Java 虚拟机中可用的对象的所有类型和行为都可以传输到另一个可能是远程的 Java 虚拟机。RMI 按实际类传递对象，因此在将对象发送到另一个 Java 虚拟机时，不会更改对象的行为。此功能允许将新类型和行为引入远程 Java 虚拟机，从而动态扩展应用程序的行为。此课程中的计算引擎示例使用此功能向分布式程序引入新行为。

**远程接口，对象以及方法**

与任何其他 Java 应用程序一样，使用 Java RMI 构建的分布式应用程序由接口和类组成。接口声明方法。类实现了接口中声明的方法，也许还声明了其他方法。在分布式应用程序中，某些实现可能驻留在某些 Java 虚拟机中，但不存在于其它虚拟机中。具有可以跨 Java 虚拟机调用的方法的对象称为*远程对象*。

通过实现*远程接口*，对象变成远程对象，具有以下特征：

- 远程接口扩展接口 `java.rmi.Remote`。
- 接口中的每个方法都声明 `java.rmi.RemoteException` 在它的 `throws` 子句中，除了所有的特定于应用的异常。

当对象从一个 Java 虚拟机传递到另一个 Java 虚拟机时，RMI 将远程对象与非远程对象区别对待。RMI 不是在接收 Java 虚拟机中复制实现对象，而是为远程对象传递远程*stub*。该存根充当远程对象的本地代表或代理，并且基本上对客户端来说是远程引用。客户端调用本地存根上的方法，该方法负责对远程对象执行方法调用。

远程对象的存根实现远程对象实现的同一组远程接口。此属性允许将存根转换为远程对象实现的任何接口。但是，只能从接收 Java 虚拟机调用远程接口中定义的那些方法。

**使用 RMI 创建分布式应用**

使用 RMI 开发分布式应用程序涉及以下一般步骤：

1. 设计和实现分布式应用程序的组件。
2. 编译源代码。
3. 使类型网络可访问。
4. 启动应用程序。

**设计并实现应用组件**

首先，确定您的应用程序体系结构，包括哪些组件是本地对象以及哪些组件可以远程访问。这一步包括：

 -  **定义远程接口。**远程接口指定可由客户端远程调用的方法。客户端面向远程接口编程，而不是这些接口的实现类。这种接口的设计包括确定将用作参数的对象类型以及这些方法的返回值。如果尚不存在任何这些接口或类，则还需要定义它们。
 -  **实现远程对象。**远程对象必须实现一个或多个远程接口。远程对象类可以包括仅在本地可用的其他接口和方法的实现。如果要将任何本地类用于参数或返回任何这些方法的值，则必须同时实现它们。
 -  **实现客户端。**在定义远程接口后，包括在部署远程对象之后，可以随时实现使用远程对象的客户端。

**编译源代码**

与任何 Java 程序一样，您使用 `javac` 编译器来编译源文件。源文件包含远程接口的声明，它们的实现，任何其他服务器类和客户端类。

------

**注意：** 对于 Java Platform，Standard Edition 5.0 之前的版本，使用 `rmic` 编译器需要额外的步骤来构建存根类。但是，现在已经不再需要此步骤。

------

**使类网络可访问**

在此步骤中，您可以访问某些类定义网络，例如远程接口及其关联类型的定义，以及需要下载到客户端或服务器的类的定义。通常可以通过 Web 服务器访问类定义。

**启动应用**

启动应用程序包括运行 RMI 远程对象注册表，服务器和客户端。

本节的其余部分将介绍用于创建计算引擎的步骤。

**构建通用计算引擎**

本课程专注于一个简单但功能强大的分布式应用程序，称为*计算引擎*。计算引擎是服务器上的远程对象，它从客户端获取任务，运行任务并返回结果。任务在运行服务器的计算机上运行。这种类型的分布式应用程序可以使许多客户端机器能够使用特别强大的机器或具有专用硬件的机器。

计算引擎的新颖之处在于，在编写或启动计算引擎时，不需要定义它运行的任务。可以随时创建新类型的任务，然后将其提供给要运行的计算引擎。任务的唯一要求是其类实现特定的接口。完成任务所需的代码可以由 RMI 系统下载到计算引擎。然后，计算引擎使用运行计算引擎的计算机上的资源运行任务。

Java 平台的动态特性支持执行任意任务的能力，该平台由 RMI 扩展到网络。RMI将任务代码动态加载到计算引擎的 Java 虚拟机中，并在不事先了解实现任务的类的情况下运行任务。这种具有动态下载代码能力的应用程序通常称为*基于行为的应用程序*。此类应用程序通常需要完全启用代理程序的基础设施。使用 RMI，此类应用程序是 Java 平台上分布式计算的基本机制的一部分。

