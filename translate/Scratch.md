## 不可交换数据结构

简单的比较—交换乐观锁定适用于共享数据结构，其中整个数据结构可以在单个比较—交换操作中与新的数据结构交换。但是，使用修改后的副本交换整个数据结构并非总是可能或可行的。

假设共享数据结构是队列。每个试图向队列中插入元素或从队列中获取元素的线程都必须复制整个队列，并对复制的队列进行所需的修改。这可以通过 `AtomicReference` 来实现。复制引用，复制并修改队列，然后尝试将 `AtomicReference` 中指向的引用交换到新创建的队列。

但是，大型数据结构可能需要大量内存和 CPU 周期才能进行复制。这将使您的应用程序花费更多的内存，并在复制上浪费大量时间。这将影响应用程序的性能，尤其是在数据结构上的争用较高时。此外，线程复制和修改数据结构所花费的时间越长，则某个其他线程在其间修改共享数据结构的可能性就越大。如您所知，如果另一个线程自复制以来已修改了共享数据结构，则所有其他线程必须重新启动其复制—修改操作。这将进一步增加对性能和内存消耗的影响。

下一节将说明一种实现非阻塞数据结构的方法，该结构可以并发更新，而不仅仅是复制和修改。